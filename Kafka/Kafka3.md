# Kafka3

## Kafka简介

Kafka是一种分布式的基于发布/订阅模式的消息队列；也是一种开源的分布式时间流平台，也可以用于数据管道、流分析、数据集成和关键任务应用。

**发布订阅**：是指，消息发布者将消息分为不同的类别，由订阅者接收需要类型的数据；

### 消息队列

企业中场景的消息队列中，大数据常用Kafka，而javaEE常用RabbitMQ等。

传统消息队列的应用场景包括：缓缓冲/消峰、解耦和异步通信。

**缓冲/消峰：** 用于控制和优化数据经过系统的速度，解决生成信息和消费信息处理速度不一致的情况。

**解耦：** 对于多种数据源（如MySql、Flume）等，设定一种相同的接口约束，取出数据时直接从消息队列出发。

**异步通信：** 允许用户把消息放入消息队列，但可以不立刻处理它，而是在需要的适合再去处理。

#### 消息队列的两种模式

1. 点对点模式：生成者将消息发送到消息队列中，而消费者从消息队列中拉去数据，消费者拿到数据后向消息队列确认收到，此时消息队列删除消息
2. 发布/订阅：可以由多个topic主题，方便订阅者进行订阅；消费者消费数据后，数据不删除，使得其他消费者可以再次获取该消息，消费者之间是独立的。

### Kafka基础架构

kafka消息队列和基础的消息队列模型一致，但是有一些特点：

1. 将一个topic划分成多个partition，方便扩展，提高了吞吐量；partition可以部署在多台服务器上。
2. 消费者被组成了group，要求一个partition的数据只能由group内一个消费者消费。
3. 为了保证数据可靠性，为每个parttion增加若干副本。虽然消费者只能读取leader副本，但leader宕机后可以让follower变成leader。
4. Kafka一部分信息存储在Zookeeper中，记录了服务器节点允许的状况、leader等信息；在Kafka2.8之前必须配合Zookeeper，之后则可以不使用。

## Kafka快速入门

### kafka配置

**server.properties**

- broker.id,是kafka集群的唯一标识，不能和其他服务器重复
- log.dirs，用于存储日志（在kafka中就是数据）的路径，不建议放在默认的tmp目录下，防止被清空
- zookeeper.connect,默认连接的zk的地址加端口号，使用逗号隔开全部zookeeper的地址，并且在最后添加一个/kafka（这样配置方便删除kafka节点）

